<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Finance Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .income-badge {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .expense-badge {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .progress-bar {
            transition: width 0.5s ease-in-out;
        }

        .tab-active {
            border-bottom: 3px solid #667eea;
            color: #667eea;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 px-4 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <h1 class="text-3xl font-bold flex items-center gap-3">
                        <i class="fas fa-wallet"></i> Finance Tracker
                    </h1>
                    <p class="text-purple-200 mt-1">Track your income & expenses</p>
                </div>
                <div class="flex gap-4 flex-wrap">
                    <div class="bg-white/20 rounded-xl px-5 py-3 text-center min-w-[140px]">
                        <p class="text-purple-200 text-sm">Total Balance</p>
                        <p id="totalBalance" class="text-2xl font-bold">$0.00</p>
                    </div>
                    <div class="bg-white/20 rounded-xl px-5 py-3 text-center min-w-[140px]">
                        <p class="text-green-200 text-sm">Income</p>
                        <p id="totalIncome" class="text-2xl font-bold text-green-300">$0.00</p>
                    </div>
                    <div class="bg-white/20 rounded-xl px-5 py-3 text-center min-w-[140px]">
                        <p class="text-red-200 text-sm">Expenses</p>
                        <p id="totalExpenses" class="text-2xl font-bold text-red-300">$0.00</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Add Transaction Section -->
        <section class="card rounded-2xl shadow-xl p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="fas fa-plus-circle text-purple-600"></i> Add Transaction
            </h2>
            <form id="transactionForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4">
                <div class="lg:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                    <select id="txType"
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="lg:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                    <input type="number" id="txAmount" step="0.01" min="0" required placeholder="0.00"
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div class="lg:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                    <select id="txCategory"
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <optgroup label="Expenses" id="expenseCategories">
                            <option value="food">üçî Food & Dining</option>
                            <option value="transport">üöó Transportation</option>
                            <option value="shopping">üõçÔ∏è Shopping</option>
                            <option value="bills">üìÑ Bills & Utilities</option>
                            <option value="entertainment">üé¨ Entertainment</option>
                            <option value="health">üíä Health</option>
                            <option value="education">üìö Education</option>
                            <option value="other_expense">üì¶ Other</option>
                        </optgroup>
                        <optgroup label="Income" id="incomeCategories">
                            <option value="salary">üíº Salary</option>
                            <option value="freelance">üíª Freelance</option>
                            <option value="investment">üìà Investment</option>
                            <option value="gift">üéÅ Gift</option>
                            <option value="other_income">üí∞ Other Income</option>
                        </optgroup>
                    </select>
                </div>
                <div class="lg:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="txDate" required
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div class="lg:col-span-1">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <input type="text" id="txDescription" placeholder="Description"
                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                </div>
                <div class="lg:col-span-1 flex items-end">
                    <button type="submit"
                        class="w-full gradient-bg text-white py-2.5 px-6 rounded-lg font-semibold hover:opacity-90 transition flex items-center justify-center gap-2">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
            </form>
        </section>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Category Breakdown -->
            <div class="card rounded-2xl shadow-xl p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-pie text-purple-600"></i> Spending by Category
                </h2>
                <div class="relative h-64">
                    <canvas id="categoryChart"></canvas>
                </div>
                <div id="categoryLegend" class="mt-4 space-y-2 max-h-32 overflow-y-auto"></div>
            </div>

            <!-- Budget Progress -->
            <div class="card rounded-2xl shadow-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                        <i class="fas fa-bullseye text-purple-600"></i> Budget Limits
                    </h2>
                    <button onclick="openBudgetModal()"
                        class="text-purple-600 hover:text-purple-800 text-sm font-medium">
                        <i class="fas fa-cog"></i> Set Budgets
                    </button>
                </div>
                <div id="budgetBars" class="space-y-4 max-h-80 overflow-y-auto"></div>
            </div>

            <!-- Monthly Trends -->
            <div class="card rounded-2xl shadow-xl p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-line text-purple-600"></i> Monthly Trends
                </h2>
                <div class="relative h-72">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Transaction History -->
        <section class="card rounded-2xl shadow-xl p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="fas fa-history text-purple-600"></i> Transaction History
            </h2>

            <!-- Filters -->
            <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6 p-4 bg-gray-50 rounded-xl">
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Search</label>
                    <input type="text" id="filterSearch" placeholder="Search..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Type</label>
                    <select id="filterType"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="all">All</option>
                        <option value="income">Income</option>
                        <option value="expense">Expense</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">Category</label>
                    <select id="filterCategory"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                        <option value="all">All Categories</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">From Date</label>
                    <input type="date" id="filterFromDate"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-600 mb-1">To Date</label>
                    <input type="date" id="filterToDate"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                </div>
            </div>

            <!-- Transaction List -->
            <div id="transactionList" class="space-y-3 max-h-96 overflow-y-auto"></div>
            <div id="noTransactions" class="text-center py-12 text-gray-500 hidden">
                <i class="fas fa-receipt text-5xl mb-4 text-gray-300"></i>
                <p>No transactions found</p>
            </div>
        </section>
    </main>

    <!-- Budget Modal -->
    <div id="budgetModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-md mx-4 max-h-[80vh] overflow-y-auto">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-800">Set Budget Limits</h3>
                <button onclick="closeBudgetModal()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="budgetInputs" class="space-y-4"></div>
            <button onclick="saveBudgets()"
                class="w-full mt-6 gradient-bg text-white py-3 rounded-lg font-semibold hover:opacity-90 transition">
                Save Budgets
            </button>
        </div>
    </div>

    <script>
        // Data Management
        const CATEGORIES = {
            expense: {
                food: { name: 'Food & Dining', icon: 'üçî', color: '#f97316' },
                transport: { name: 'Transportation', icon: 'üöó', color: '#3b82f6' },
                shopping: { name: 'Shopping', icon: 'üõçÔ∏è', color: '#ec4899' },
                bills: { name: 'Bills & Utilities', icon: 'üìÑ', color: '#8b5cf6' },
                entertainment: { name: 'Entertainment', icon: 'üé¨', color: '#10b981' },
                health: { name: 'Health', icon: 'üíä', color: '#ef4444' },
                education: { name: 'Education', icon: 'üìö', color: '#06b6d4' },
                other_expense: { name: 'Other', icon: 'üì¶', color: '#6b7280' }
            },
            income: {
                salary: { name: 'Salary', icon: 'üíº', color: '#22c55e' },
                freelance: { name: 'Freelance', icon: 'üíª', color: '#14b8a6' },
                investment: { name: 'Investment', icon: 'üìà', color: '#eab308' },
                gift: { name: 'Gift', icon: 'üéÅ', color: '#f472b6' },
                other_income: { name: 'Other Income', icon: 'üí∞', color: '#a3a3a3' }
            }
        };

        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let budgets = JSON.parse(localStorage.getItem('budgets')) || {};
        let categoryChart, trendChart;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('txDate').valueAsDate = new Date();
            populateFilterCategories();
            initCharts();
            updateAll();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('transactionForm').addEventListener('submit', addTransaction);
            document.getElementById('txType').addEventListener('change', updateCategoryOptions);
            ['filterSearch', 'filterType', 'filterCategory', 'filterFromDate', 'filterToDate'].forEach(id => {
                document.getElementById(id).addEventListener('input', renderTransactions);
                document.getElementById(id).addEventListener('change', renderTransactions);
            });
        }

        function updateCategoryOptions() {
            const type = document.getElementById('txType').value;
            const categorySelect = document.getElementById('txCategory');
            const expenseGroup = document.getElementById('expenseCategories');
            const incomeGroup = document.getElementById('incomeCategories');

            if (type === 'expense') {
                expenseGroup.style.display = '';
                incomeGroup.style.display = 'none';
                categorySelect.value = 'food';
            } else {
                expenseGroup.style.display = 'none';
                incomeGroup.style.display = '';
                categorySelect.value = 'salary';
            }
        }

        function populateFilterCategories() {
            const select = document.getElementById('filterCategory');
            select.innerHTML = '<option value="all">All Categories</option>';

            const expGroup = document.createElement('optgroup');
            expGroup.label = 'Expenses';
            Object.entries(CATEGORIES.expense).forEach(([key, cat]) => {
                expGroup.innerHTML += `<option value="${key}">${cat.icon} ${cat.name}</option>`;
            });
            select.appendChild(expGroup);

            const incGroup = document.createElement('optgroup');
            incGroup.label = 'Income';
            Object.entries(CATEGORIES.income).forEach(([key, cat]) => {
                incGroup.innerHTML += `<option value="${key}">${cat.icon} ${cat.name}</option>`;
            });
            select.appendChild(incGroup);
        }

        function addTransaction(e) {
            e.preventDefault();
            const tx = {
                id: Date.now(),
                type: document.getElementById('txType').value,
                amount: parseFloat(document.getElementById('txAmount').value),
                category: document.getElementById('txCategory').value,
                date: document.getElementById('txDate').value,
                description: document.getElementById('txDescription').value || 'No description'
            };

            transactions.unshift(tx);
            saveData();
            updateAll();
            e.target.reset();
            document.getElementById('txDate').valueAsDate = new Date();
            updateCategoryOptions();
        }

        function deleteTransaction(id) {
            if (confirm('Delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                updateAll();
            }
        }

        function saveData() {
            localStorage.setItem('transactions', JSON.stringify(transactions));
            localStorage.setItem('budgets', JSON.stringify(budgets));
        }

        function updateAll() {
            updateSummary();
            renderTransactions();
            updateCategoryChart();
            updateBudgetBars();
            updateTrendChart();
        }

        function updateSummary() {
            const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
            const expenses = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            document.getElementById('totalBalance').textContent = formatCurrency(income - expenses);
        }

        function renderTransactions() {
            const search = document.getElementById('filterSearch').value.toLowerCase();
            const type = document.getElementById('filterType').value;
            const category = document.getElementById('filterCategory').value;
            const fromDate = document.getElementById('filterFromDate').value;
            const toDate = document.getElementById('filterToDate').value;

            let filtered = transactions.filter(t => {
                if (type !== 'all' && t.type !== type) return false;
                if (category !== 'all' && t.category !== category) return false;
                if (fromDate && t.date < fromDate) return false;
                if (toDate && t.date > toDate) return false;
                if (search && !t.description.toLowerCase().includes(search) &&
                    !getCategoryInfo(t).name.toLowerCase().includes(search)) return false;
                return true;
            });

            const container = document.getElementById('transactionList');
            const noTx = document.getElementById('noTransactions');

            if (filtered.length === 0) {
                container.innerHTML = '';
                noTx.classList.remove('hidden');
                return;
            }

            noTx.classList.add('hidden');
            container.innerHTML = filtered.map(t => {
                const cat = getCategoryInfo(t);
                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl" style="background: ${cat.color}20">
                                ${cat.icon}
                            </div>
                            <div>
                                <p class="font-semibold text-gray-800">${t.description}</p>
                                <p class="text-sm text-gray-500">${cat.name} ‚Ä¢ ${formatDate(t.date)}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}">
                                ${t.type === 'income' ? '+' : '-'}${formatCurrency(t.amount)}
                            </span>
                            <button onclick="deleteTransaction(${t.id})" class="text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCategoryInfo(tx) {
            return CATEGORIES[tx.type][tx.category] || { name: 'Unknown', icon: '‚ùì', color: '#888' };
        }

        function initCharts() {
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            categoryChart = new Chart(categoryCtx, {
                type: 'doughnut',
                data: { labels: [], datasets: [{ data: [], backgroundColor: [] }] },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    cutout: '65%'
                }
            });

            const trendCtx = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(trendCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        { label: 'Income', data: [], backgroundColor: '#22c55e', borderRadius: 6 },
                        { label: 'Expenses', data: [], backgroundColor: '#ef4444', borderRadius: 6 }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#f3f4f6' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateCategoryChart() {
            const expensesByCategory = {};
            const currentMonth = new Date().toISOString().slice(0, 7);

            transactions
                .filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
                });

            const labels = [];
            const data = [];
            const colors = [];
            const legendContainer = document.getElementById('categoryLegend');
            legendContainer.innerHTML = '';

            Object.entries(expensesByCategory).sort((a, b) => b[1] - a[1]).forEach(([cat, amount]) => {
                const info = CATEGORIES.expense[cat];
                if (info) {
                    labels.push(info.name);
                    data.push(amount);
                    colors.push(info.color);
                    legendContainer.innerHTML += `
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center gap-2">
                                <div class="w-3 h-3 rounded-full" style="background: ${info.color}"></div>
                                <span>${info.icon} ${info.name}</span>
                            </div>
                            <span class="font-semibold">${formatCurrency(amount)}</span>
                        </div>
                    `;
                }
            });

            if (data.length === 0) {
                legendContainer.innerHTML = '<p class="text-gray-400 text-center py-4">No expenses this month</p>';
            }

            categoryChart.data.labels = labels;
            categoryChart.data.datasets[0].data = data;
            categoryChart.data.datasets[0].backgroundColor = colors;
            categoryChart.update();
        }

        function updateBudgetBars() {
            const container = document.getElementById('budgetBars');
            const currentMonth = new Date().toISOString().slice(0, 7);

            const spending = {};
            transactions
                .filter(t => t.type === 'expense' && t.date.startsWith(currentMonth))
                .forEach(t => {
                    spending[t.category] = (spending[t.category] || 0) + t.amount;
                });

            let html = '';
            Object.entries(CATEGORIES.expense).forEach(([key, cat]) => {
                const spent = spending[key] || 0;
                const budget = budgets[key] || 0;

                if (budget > 0 || spent > 0) {
                    const percent = budget > 0 ? Math.min((spent / budget) * 100, 100) : 0;
                    const isOver = spent > budget && budget > 0;
                    const barColor = isOver ? '#ef4444' : percent > 80 ? '#f59e0b' : '#22c55e';

                    html += `
                        <div class="space-y-1">
                            <div class="flex justify-between text-sm">
                                <span class="font-medium">${cat.icon} ${cat.name}</span>
                                <span class="${isOver ? 'text-red-600 font-bold' : 'text-gray-600'}">
                                    ${formatCurrency(spent)} ${budget > 0 ? '/ ' + formatCurrency(budget) : ''}
                                    ${isOver ? ' ‚ö†Ô∏è' : ''}
                                </span>
                            </div>
                            <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                <div class="h-full progress-bar rounded-full" style="width: ${percent}%; background: ${barColor}"></div>
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html || '<p class="text-gray-400 text-center py-4">Set budgets to track spending</p>';
        }

        function updateTrendChart() {
            const months = {};
            const now = new Date();

            for (let i = 5; i >= 0; i--) {
                const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
                const key = d.toISOString().slice(0, 7);
                months[key] = { income: 0, expense: 0, label: d.toLocaleDateString('en-US', { month: 'short' }) };
            }

            transactions.forEach(t => {
                const month = t.date.slice(0, 7);
                if (months[month]) {
                    months[month][t.type] += t.amount;
                }
            });

            const labels = Object.values(months).map(m => m.label);
            const incomeData = Object.values(months).map(m => m.income);
            const expenseData = Object.values(months).map(m => m.expense);

            trendChart.data.labels = labels;
            trendChart.data.datasets[0].data = incomeData;
            trendChart.data.datasets[1].data = expenseData;
            trendChart.update();
        }

        function openBudgetModal() {
            const container = document.getElementById('budgetInputs');
            container.innerHTML = Object.entries(CATEGORIES.expense).map(([key, cat]) => `
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">${cat.icon} ${cat.name}</label>
                    <input type="number" id="budget_${key}" value="${budgets[key] || ''}" min="0" step="0.01" 
                        placeholder="No limit" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                </div>
            `).join('');
            document.getElementById('budgetModal').classList.remove('hidden');
        }

        function closeBudgetModal() {
            document.getElementById('budgetModal').classList.add('hidden');
        }

        function saveBudgets() {
            Object.keys(CATEGORIES.expense).forEach(key => {
                const input = document.getElementById(`budget_${key}`);
                const value = parseFloat(input.value);
                if (value > 0) {
                    budgets[key] = value;
                } else {
                    delete budgets[key];
                }
            });
            saveData();
            updateBudgetBars();
            closeBudgetModal();
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
        }

        function formatDate(dateStr) {
            return new Date(dateStr + 'T00:00:00').toLocaleDateString('en-US', {
                month: 'short', day: 'numeric', year: 'numeric'
            });
        }

        // Close modal on outside click
        document.getElementById('budgetModal').addEventListener('click', (e) => {
            if (e.target.id === 'budgetModal') closeBudgetModal();
        });
    </script>
</body>

</html>