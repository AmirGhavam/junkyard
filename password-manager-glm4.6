<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureVault - Password Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .dark { color-scheme: dark; }
        .password-strength-weak { background: linear-gradient(90deg, #ef4444 33%, #e5e7eb 33%); }
        .password-strength-fair { background: linear-gradient(90deg, #f59e0b 66%, #e5e7eb 66%); }
        .password-strength-strong { background: linear-gradient(90deg, #10b981 100%, #e5e7eb 0%); }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-300">
    <!-- Master Password Lock Screen -->
    <div id="lockScreen" class="fixed inset-0 bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center z-50">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <i class="fas fa-shield-alt text-6xl text-blue-600 dark:text-blue-400 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white">SecureVault</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-2">Enter your master password to continue</p>
            </div>
            <input type="password" id="masterPassword" placeholder="Master Password" 
                   class="w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white mb-4">
            <div class="flex items-center mb-4">
                <input type="checkbox" id="rememberMaster" class="mr-2">
                <label for="rememberMaster" class="text-sm text-gray-600 dark:text-gray-400">Remember for 24 hours</label>
            </div>
            <button onclick="unlock()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                Unlock Vault
            </button>
            <button onclick="setupMasterPassword()" class="w-full mt-3 text-blue-600 dark:text-blue-400 hover:underline text-sm">
                Set up master password
            </button>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <i class="fas fa-shield-alt text-3xl text-blue-600 dark:text-blue-400"></i>
                        <h1 class="text-2xl font-bold text-gray-800 dark:text-white">SecureVault</h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="autoLockTimer" class="text-sm text-gray-600 dark:text-gray-400"></span>
                        <button onclick="toggleDarkMode()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i id="themeIcon" class="fas fa-moon text-gray-600 dark:text-gray-400"></i>
                        </button>
                        <button onclick="lockVault()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-lock text-gray-600 dark:text-gray-400"></i>
                        </button>
                        <button onclick="showSettings()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <i class="fas fa-cog text-gray-600 dark:text-gray-400"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Total Passwords</p>
                            <p id="totalPasswords" class="text-2xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <i class="fas fa-key text-3xl text-blue-500 opacity-50"></i>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Weak Passwords</p>
                            <p id="weakPasswords" class="text-2xl font-bold text-red-600">0</p>
                        </div>
                        <i class="fas fa-exclamation-triangle text-3xl text-red-500 opacity-50"></i>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Categories</p>
                            <p id="totalCategories" class="text-2xl font-bold text-gray-800 dark:text-white">0</p>
                        </div>
                        <i class="fas fa-folder text-3xl text-green-500 opacity-50"></i>
                    </div>
                </div>
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-600 dark:text-gray-400 text-sm">Expired</p>
                            <p id="expiredPasswords" class="text-2xl font-bold text-orange-600">0</p>
                        </div>
                        <i class="fas fa-clock text-3xl text-orange-500 opacity-50"></i>
                    </div>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow p-6 mb-6">
                <div class="flex flex-col md:flex-row gap-4">
                    <div class="flex-1">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search passwords..." 
                                   class="w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"
                                   onkeyup="filterPasswords()">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    <select id="categoryFilter" onchange="filterPasswords()" 
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        <option value="">All Categories</option>
                    </select>
                    <select id="sortBy" onchange="sortPasswords()" 
                            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        <option value="name">Sort by Name</option>
                        <option value="date">Sort by Date</option>
                        <option value="strength">Sort by Strength</option>
                        <option value="category">Sort by Category</option>
                    </select>
                    <button onclick="showAddModal()" 
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                        <i class="fas fa-plus mr-2"></i>Add Password
                    </button>
                </div>
            </div>

            <!-- Password List -->
            <div id="passwordList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Password cards will be inserted here -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="text-center py-16">
                <i class="fas fa-inbox text-6xl text-gray-300 dark:text-gray-600 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2">No passwords yet</h3>
                <p class="text-gray-500 dark:text-gray-500 mb-6">Start by adding your first password</p>
                <button onclick="showAddModal()" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    <i class="fas fa-plus mr-2"></i>Add First Password
                </button>
            </div>
        </main>
    </div>

    <!-- Add/Edit Password Modal -->
    <div id="passwordModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto fade-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="modalTitle" class="text-2xl font-bold text-gray-800 dark:text-white">Add New Password</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <form id="passwordForm" onsubmit="savePassword(event)">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Name/Title</label>
                            <input type="text" id="entryName" required 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
                            <select id="entryCategory" 
                                    class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <option value="Personal">Personal</option>
                                <option value="Work">Work</option>
                                <option value="Finance">Finance</option>
                                <option value="Social">Social</option>
                                <option value="Shopping">Shopping</option>
                                <option value="Entertainment">Entertainment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Username/Email</label>
                            <input type="text" id="entryUsername" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="entryPassword" required 
                                       class="w-full px-4 py-2 pr-20 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                                <button type="button" onclick="togglePasswordVisibility('entryPassword')" 
                                        class="absolute right-2 top-2 text-gray-500 hover:text-gray-700 dark:text-gray-400">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button type="button" onclick="generatePassword()" 
                                        class="absolute right-10 top-2 text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-dice"></i>
                                </button>
                            </div>
                            <div id="passwordStrength" class="mt-2 h-2 bg-gray-200 rounded-full"></div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">URL/Website</label>
                            <input type="url" id="entryUrl" placeholder="https://example.com" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Expiry Date</label>
                            <input type="date" id="entryExpiry" 
                                   class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Notes</label>
                        <textarea id="entryNotes" rows="3" 
                                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"></textarea>
                    </div>
                    <div class="mt-6 flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" 
                                class="px-6 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                            Save Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Password Generator Modal -->
    <div id="generatorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md fade-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800 dark:text-white">Password Generator</h2>
                    <button onclick="closeGeneratorModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="mb-4">
                    <div class="relative">
                        <input type="text" id="generatedPassword" readonly 
                               class="w-full px-4 py-3 pr-12 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white font-mono">
                        <button onclick="copyGeneratedPassword()" 
                                class="absolute right-2 top-2 text-blue-500 hover:text-blue-700">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex items-center justify-between">
                        <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Length</label>
                        <input type="range" id="passwordLength" min="8" max="32" value="16" 
                               class="w-32" onchange="updatePasswordLength()">
                        <span id="lengthValue" class="text-sm font-semibold text-gray-700 dark:text-gray-300">16</span>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeUppercase" checked class="mr-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Uppercase (A-Z)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeLowercase" checked class="mr-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Lowercase (a-z)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeNumbers" checked class="mr-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Numbers (0-9)</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeSymbols" checked class="mr-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Symbols (!@#$%^&*)</span>
                        </label>
                    </div>
                </div>
                <div class="mt-6 flex space-x-3">
                    <button onclick="generateNewPassword()" 
                            class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                        Generate
                    </button>
                    <button onclick="useGeneratedPassword()" 
                            class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                        Use This Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto fade-in">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-white">Settings</h2>
                    <button onclick="closeSettingsModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Security Settings</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <label class="text-sm text-gray-700 dark:text-gray-300">Auto-lock after (minutes)</label>
                                <select id="autoLockTime" onchange="updateAutoLockTime()" 
                                        class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                    <option value="5">5 minutes</option>
                                    <option value="10" selected>10 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="0">Never</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <label class="text-sm text-gray-700 dark:text-gray-300">Clear clipboard after (seconds)</label>
                                <select id="clearClipboard" 
                                        class="px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-700 dark:text-white">
                                    <option value="0">Never</option>
                                    <option value="30" selected>30 seconds</option>
                                    <option value="60">1 minute</option>
                                    <option value="120">2 minutes</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Data Management</h3>
                        <div class="space-y-3">
                            <button onclick="exportData()" 
                                    class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                <i class="fas fa-download mr-2"></i>Export Passwords (JSON)
                            </button>
                            <button onclick="importData()" 
                                    class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">
                                <i class="fas fa-upload mr-2"></i>Import Passwords (JSON)
                            </button>
                            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                            <button onclick="backupToCloud()" 
                                    class="w-full px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold">
                                <i class="fas fa-cloud-upload-alt mr-2"></i>Backup to Cloud
                            </button>
                            <button onclick="restoreFromCloud()" 
                                    class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                                <i class="fas fa-cloud-download-alt mr-2"></i>Restore from Cloud
                            </button>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Danger Zone</h3>
                        <button onclick="clearAllData()" 
                                class="w-full px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">
                            <i class="fas fa-trash mr-2"></i>Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let passwords = [];
        let masterPasswordHash = '';
        let isUnlocked = false;
        let autoLockTimer = null;
        let autoLockMinutes = 10;
        let currentEditId = null;
        let darkMode = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadDarkMode();
            checkMasterPassword();
            setupEventListeners();
        });

        // Master password functions
        function checkMasterPassword() {
            const savedHash = localStorage.getItem('masterPasswordHash');
            const rememberTime = localStorage.getItem('rememberMasterTime');
            
            if (savedHash && rememberTime && Date.now() < parseInt(rememberTime)) {
                isUnlocked = true;
                document.getElementById('lockScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                loadPasswords();
                startAutoLockTimer();
            } else if (savedHash) {
                // Show lock screen
            } else {
                setupMasterPassword();
            }
        }

        function setupMasterPassword() {
            const newPassword = prompt('Set your master password (must be at least 8 characters):');
            if (newPassword && newPassword.length >= 8) {
                masterPasswordHash = btoa(newPassword);
                localStorage.setItem('masterPasswordHash', masterPasswordHash);
                alert('Master password set successfully!');
                checkMasterPassword();
            } else if (newPassword) {
                alert('Password must be at least 8 characters long');
                setupMasterPassword();
            }
        }

        function unlock() {
            const inputPassword = document.getElementById('masterPassword').value;
            const savedHash = localStorage.getItem('masterPasswordHash');
            
            if (btoa(inputPassword) === savedHash) {
                isUnlocked = true;
                document.getElementById('lockScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                
                if (document.getElementById('rememberMaster').checked) {
                    localStorage.setItem('rememberMasterTime', Date.now() + (24 * 60 * 60 * 1000));
                }
                
                loadPasswords();
                startAutoLockTimer();
            } else {
                alert('Incorrect master password!');
            }
        }

        function lockVault() {
            isUnlocked = false;
            document.getElementById('lockScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('masterPassword').value = '';
            stopAutoLockTimer();
        }

        // Auto-lock timer
        function startAutoLockTimer() {
            if (autoLockMinutes === 0) return;
            
            let seconds = autoLockMinutes * 60;
            updateTimerDisplay(seconds);
            
            autoLockTimer = setInterval(() => {
                seconds--;
                updateTimerDisplay(seconds);
                
                if (seconds <= 0) {
                    lockVault();
                }
            }, 1000);
        }

        function stopAutoLockTimer() {
            if (autoLockTimer) {
                clearInterval(autoLockTimer);
                autoLockTimer = null;
            }
        }

        function updateTimerDisplay(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            const display = `${minutes}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('autoLockTimer').textContent = display;
        }

        function updateAutoLockTime() {
            autoLockMinutes = parseInt(document.getElementById('autoLockTime').value);
            stopAutoLockTimer();
            if (isUnlocked) {
                startAutoLockTimer();
            }
        }

        // Dark mode
        function loadDarkMode() {
            darkMode = localStorage.getItem('darkMode') === 'true';
            if (darkMode) {
                document.documentElement.classList.add('dark');
                document.getElementById('themeIcon').classList.replace('fa-moon', 'fa-sun');
            }
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            localStorage.setItem('darkMode', darkMode);
            document.documentElement.classList.toggle('dark');
            const icon = document.getElementById('themeIcon');
            if (darkMode) {
                icon.classList.replace('fa-moon', 'fa-sun');
            } else {
                icon.classList.replace('fa-sun', 'fa-moon');
            }
        }

        // Password management
        function loadPasswords() {
            const encrypted = localStorage.getItem('passwords');
            if (encrypted) {
                try {
                    passwords = JSON.parse(encrypted);
                } catch (e) {
                    passwords = [];
                }
            }
            displayPasswords();
            updateStats();
            updateCategoryFilter();
        }

        function savePasswords() {
            localStorage.setItem('passwords', JSON.stringify(passwords));
            updateStats();
            updateCategoryFilter();
        }

        function displayPasswords(filteredPasswords = null) {
            const passwordList = document.getElementById('passwordList');
            const emptyState = document.getElementById('emptyState');
            const displayList = filteredPasswords || passwords;
            
            if (displayList.length === 0) {
                passwordList.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            passwordList.innerHTML = displayList.map(pwd => {
                const isExpired = pwd.expiry && new Date(pwd.expiry) < new Date();
                const strength = calculatePasswordStrength(pwd.password);
                const strengthClass = strength < 40 ? 'weak' : strength < 70 ? 'fair' : 'strong';
                const strengthColor = strength < 40 ? 'red' : strength < 70 ? 'yellow' : 'green';
                
                return `
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow hover:shadow-lg transition-shadow p-4 slide-in ${isExpired ? 'border-2 border-orange-400' : ''}">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800 dark:text-white text-lg">${pwd.name}</h3>
                                <span class="inline-block px-2 py-1 text-xs rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200">
                                    ${pwd.category}
                                </span>
                                ${isExpired ? '<span class="ml-2 inline-block px-2 py-1 text-xs rounded-full bg-orange-100 dark:bg-orange-900 text-orange-800 dark:text-orange-200">Expired</span>' : ''}
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="copyPassword('${pwd.id}')" class="text-blue-500 hover:text-blue-700">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button onclick="editPassword('${pwd.id}')" class="text-green-500 hover:text-green-700">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deletePassword('${pwd.id}')" class="text-red-500 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2 text-sm">
                            ${pwd.username ? `<p class="text-gray-600 dark:text-gray-400"><i class="fas fa-user mr-2"></i>${pwd.username}</p>` : ''}
                            ${pwd.url ? `<p class="text-gray-600 dark:text-gray-400"><i class="fas fa-globe mr-2"></i><a href="${pwd.url}" target="_blank" class="text-blue-500 hover:underline">${new URL(pwd.url).hostname}</a></p>` : ''}
                            <div class="flex items-center">
                                <span class="text-gray-600 dark:text-gray-400 mr-2">Strength:</span>
                                <div class="flex-1 h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div class="h-full password-strength-${strengthClass}" style="width: ${strength}%"></div>
                                </div>
                                <span class="ml-2 text-${strengthColor}-600 font-semibold">${strength}%</span>
                            </div>
                            ${pwd.expiry ? `<p class="text-gray-600 dark:text-gray-400"><i class="fas fa-calendar mr-2"></i>Expires: ${new Date(pwd.expiry).toLocaleDateString()}</p>` : ''}
                            ${pwd.notes ? `<p class="text-gray-600 dark:text-gray-400 italic">${pwd.notes.substring(0, 50)}${pwd.notes.length > 50 ? '...' : ''}</p>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function savePassword(event) {
            event.preventDefault();
            
            const passwordData = {
                id: currentEditId || generateId(),
                name: document.getElementById('entryName').value,
                category: document.getElementById('entryCategory').value,
                username: document.getElementById('entryUsername').value,
                password: document.getElementById('entryPassword').value,
                url: document.getElementById('entryUrl').value,
                expiry: document.getElementById('entryExpiry').value,
                notes: document.getElementById('entryNotes').value,
                createdAt: currentEditId ? getPasswordById(currentEditId).createdAt : new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            if (currentEditId) {
                const index = passwords.findIndex(p => p.id === currentEditId);
                passwords[index] = passwordData;
            } else {
                passwords.push(passwordData);
            }
            
            savePasswords();
            displayPasswords();
            closeModal();
            showNotification(currentEditId ? 'Password updated successfully!' : 'Password added successfully!');
        }

        function editPassword(id) {
            const password = getPasswordById(id);
            if (!password) return;
            
            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'Edit Password';
            document.getElementById('entryName').value = password.name;
            document.getElementById('entryCategory').value = password.category;
            document.getElementById('entryUsername').value = password.username || '';
            document.getElementById('entryPassword').value = password.password;
            document.getElementById('entryUrl').value = password.url || '';
            document.getElementById('entryExpiry').value = password.expiry || '';
            document.getElementById('entryNotes').value = password.notes || '';
            
            document.getElementById('passwordModal').classList.remove('hidden');
            updatePasswordStrength();
        }

        function deletePassword(id) {
            if (confirm('Are you sure you want to delete this password?')) {
                passwords = passwords.filter(p => p.id !== id);
                savePasswords();
                displayPasswords();
                showNotification('Password deleted successfully!');
            }
        }

        function copyPassword(id) {
            const password = getPasswordById(id);
            if (password) {
                navigator.clipboard.writeText(password.password);
                showNotification('Password copied to clipboard!');
                
                const clearTime = parseInt(document.getElementById('clearClipboard').value) * 1000;
                if (clearTime > 0) {
                    setTimeout(() => {
                        navigator.clipboard.writeText('');
                    }, clearTime);
                }
            }
        }

        // Password generation
        function generatePassword() {
            document.getElementById('generatorModal').classList.remove('hidden');
            generateNewPassword();
        }

        function generateNewPassword() {
            const length = parseInt(document.getElementById('passwordLength').value);
            const includeUppercase = document.getElementById('includeUppercase').checked;
            const includeLowercase = document.getElementById('includeLowercase').checked;
            const includeNumbers = document.getElementById('includeNumbers').checked;
            const includeSymbols = document.getElementById('includeSymbols').checked;
            
            let charset = '';
            if (includeUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) charset += '0123456789';
            if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            if (charset === '') {
                alert('Please select at least one character type');
                return;
            }
            
            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            
            document.getElementById('generatedPassword').value = password;
        }

        function useGeneratedPassword() {
            const generated = document.getElementById('generatedPassword').value;
            if (generated) {
                document.getElementById('entryPassword').value = generated;
                updatePasswordStrength();
                closeGeneratorModal();
            }
        }

        function copyGeneratedPassword() {
            const password = document.getElementById('generatedPassword').value;
            navigator.clipboard.writeText(password);
            showNotification('Generated password copied to clipboard!');
        }

        function updatePasswordLength() {
            const length = document.getElementById('passwordLength').value;
            document.getElementById('lengthValue').textContent = length;
            generateNewPassword();
        }

        // Password strength
        function calculatePasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength += 20;
            if (password.length >= 12) strength += 20;
            if (password.length >= 16) strength += 10;
            if (/[a-z]/.test(password)) strength += 10;
            if (/[A-Z]/.test(password)) strength += 10;
            if (/[0-9]/.test(password)) strength += 10;
            if (/[^a-zA-Z0-9]/.test(password)) strength += 20;
            return Math.min(strength, 100);
        }

        function updatePasswordStrength() {
            const password = document.getElementById('entryPassword').value;
            const strength = calculatePasswordStrength(password);
            const strengthBar = document.getElementById('passwordStrength');
            
            if (strength < 40) {
                strengthBar.className = 'mt-2 h-2 bg-gray-200 rounded-full password-strength-weak';
            } else if (strength < 70) {
                strengthBar.className = 'mt-2 h-2 bg-gray-200 rounded-full password-strength-fair';
            } else {
                strengthBar.className = 'mt-2 h-2 bg-gray-200 rounded-full password-strength-strong';
            }
        }

        // Search and filter
        function filterPasswords() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            
            let filtered = passwords;
            
            if (searchTerm) {
                filtered = filtered.filter(pwd => 
                    pwd.name.toLowerCase().includes(searchTerm) ||
                    (pwd.username && pwd.username.toLowerCase().includes(searchTerm)) ||
                    (pwd.url && pwd.url.toLowerCase().includes(searchTerm)) ||
                    (pwd.notes && pwd.notes.toLowerCase().includes(searchTerm))
                );
            }
            
            if (category) {
                filtered = filtered.filter(pwd => pwd.category === category);
            }
            
            displayPasswords(filtered);
        }

        function sortPasswords() {
            const sortBy = document.getElementById('sortBy').value;
            
            passwords.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'date':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'strength':
                        return calculatePasswordStrength(b.password) - calculatePasswordStrength(a.password);
                    case 'category':
                        return a.category.localeCompare(b.category);
                    default:
                        return 0;
                }
            });
            
            displayPasswords();
        }

        // Statistics
        function updateStats() {
            const total = passwords.length;
            const weak = passwords.filter(p => calculatePasswordStrength(p.password) < 40).length;
            const categories = [...new Set(passwords.map(p => p.category))].length;
            const expired = passwords.filter(p => p.expiry && new Date(p.expiry) < new Date()).length;
            
            document.getElementById('totalPasswords').textContent = total;
            document.getElementById('weakPasswords').textContent = weak;
            document.getElementById('totalCategories').textContent = categories;
            document.getElementById('expiredPasswords').textContent = expired;
        }

        function updateCategoryFilter() {
            const categories = [...new Set(passwords.map(p => p.category))];
            const select = document.getElementById('categoryFilter');
            const currentValue = select.value;
            
            select.innerHTML = '<option value="">All Categories</option>';
            categories.forEach(cat => {
                select.innerHTML += `<option value="${cat}">${cat}</option>`;
            });
            
            select.value = currentValue;
        }

        // Data management
        function exportData() {
            const dataStr = JSON.stringify(passwords, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            const exportFileDefaultName = `passwords_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            showNotification('Passwords exported successfully!');
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        passwords = [...passwords, ...imported];
                        savePasswords();
                        displayPasswords();
                        showNotification('Passwords imported successfully!');
                    } else {
                        alert('Invalid file format');
                    }
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function backupToCloud() {
            // Simulate cloud backup
            localStorage.setItem('cloudBackup', JSON.stringify(passwords));
            localStorage.setItem('cloudBackupDate', new Date().toISOString());
            showNotification('Backup saved to cloud storage!');
        }

        function restoreFromCloud() {
            const backup = localStorage.getItem('cloudBackup');
            if (backup) {
                if (confirm('This will overwrite all current passwords. Continue?')) {
                    passwords = JSON.parse(backup);
                    savePasswords();
                    displayPasswords();
                    const backupDate = new Date(localStorage.getItem('cloudBackupDate')).toLocaleDateString();
                    showNotification(`Restored from backup (${backupDate})`);
                }
            } else {
                showNotification('No cloud backup found');
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL passwords? This action cannot be undone!')) {
                if (confirm('This is your final warning. All data will be permanently deleted.')) {
                    passwords = [];
                    savePasswords();
                    displayPasswords();
                    showNotification('All data cleared');
                }
            }
        }

        // Utility functions
        function generateId() {
            return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function getPasswordById(id) {
            return passwords.find(p => p.id === id);
        }

        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.target;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.replace('fa-eye', 'fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.replace('fa-eye-slash', 'fa-eye');
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 fade-in';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Modal functions
        function showAddModal() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Add New Password';
            document.getElementById('passwordForm').reset();
            document.getElementById('passwordModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('passwordModal').classList.add('hidden');
            document.getElementById('passwordForm').reset();
            currentEditId = null;
        }

        function closeGeneratorModal() {
            document.getElementById('generatorModal').classList.add('hidden');
        }

        function showSettings() {
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        // Event listeners
        function setupEventListeners() {
            document.getElementById('entryPassword').addEventListener('input', updatePasswordStrength);
            
            // Reset auto-lock timer on user activity
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
                document.addEventListener(event, () => {
                    if (isUnlocked && autoLockMinutes > 0) {
                        stopAutoLockTimer();
                        startAutoLockTimer();
                    }
                }, true);
            });
            
            // Close modals on Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                    closeGeneratorModal();
                    closeSettingsModal();
                }
            });
        }
    </script>
</body>
</html>