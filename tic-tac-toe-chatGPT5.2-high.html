<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Tic-Tac-Toe (Human vs Human / Optional AI)</title>
    <style>
        :root {
            --bg: #0f172a;
            --panel: #111c3a;
            --cell: #0b1226;
            --cellHover: #0f1a38;
            --text: #e5e7eb;
            --muted: #a3a3a3;
            --accent: #60a5fa;
            --win: #22c55e;
            --danger: #ef4444;
            --border: rgba(255, 255, 255, .12);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: grid;
            place-items: center;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
            background: radial-gradient(1000px 500px at 50% -10%, rgba(96, 165, 250, .25), transparent 60%),
                radial-gradient(900px 700px at 80% 110%, rgba(34, 197, 94, .18), transparent 55%),
                var(--bg);
            color: var(--text);
            padding: 24px;
        }

        .app {
            width: min(520px, 92vw);
            background: rgba(17, 28, 58, .55);
            border: 1px solid var(--border);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            padding: 18px;
        }

        header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 14px;
        }

        h1 {
            font-size: 18px;
            margin: 0;
            letter-spacing: .2px;
        }

        .status {
            font-size: 13px;
            color: var(--muted);
            margin-top: 4px;
            line-height: 1.35;
        }

        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .control {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text);
            user-select: none;
            padding: 8px 10px;
            border: 1px solid var(--border);
            background: rgba(15, 23, 42, .45);
            border-radius: 999px;
        }

        .control input {
            accent-color: var(--accent);
        }

        button {
            cursor: pointer;
            padding: 9px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: rgba(15, 23, 42, .55);
            color: var(--text);
            font-weight: 600;
        }

        button:hover {
            background: rgba(15, 23, 42, .75);
        }

        button:active {
            transform: translateY(1px);
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            padding: 12px;
            border-radius: 14px;
            background: rgba(15, 23, 42, .35);
            border: 1px solid var(--border);
        }

        .cell {
            aspect-ratio: 1 / 1;
            display: grid;
            place-items: center;
            font-size: 52px;
            font-weight: 800;
            letter-spacing: 1px;
            background: rgba(11, 18, 38, .7);
            border: 1px solid var(--border);
            border-radius: 14px;
            cursor: pointer;
            transition: background .12s ease, border-color .12s ease, transform .06s ease;
            user-select: none;
        }

        .cell:hover {
            background: rgba(15, 26, 56, .7);
        }

        .cell:active {
            transform: scale(.99);
        }

        .cell.disabled {
            cursor: not-allowed;
            opacity: .88;
        }

        .cell.x {
            color: #93c5fd;
        }

        .cell.o {
            color: #fca5a5;
        }

        .cell.win {
            border-color: rgba(34, 197, 94, .9);
            box-shadow: 0 0 0 2px rgba(34, 197, 94, .35) inset, 0 0 24px rgba(34, 197, 94, .15);
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
            color: var(--muted);
            font-size: 12px;
        }

        .pill {
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 999px;
            background: rgba(15, 23, 42, .35);
        }
    </style>
</head>

<body>
    <div class="app" role="application" aria-label="Tic-Tac-Toe">
        <header>
            <div>
                <h1>Tic-Tac-Toe</h1>
                <div class="status" id="status">Turn: <b>X</b></div>
            </div>
            <div class="controls">
                <label class="control" title="Enable computer opponent (plays O)">
                    <input id="vsAI" type="checkbox" />
                    Play vs AI (O)
                </label>
                <button id="restart" type="button">New Game</button>
            </div>
        </header>

        <div class="board" id="board" aria-label="3 by 3 board" role="grid">
            <div class="cell" role="gridcell" tabindex="0" data-i="0" aria-label="Cell 1"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="1" aria-label="Cell 2"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="2" aria-label="Cell 3"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="3" aria-label="Cell 4"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="4" aria-label="Cell 5"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="5" aria-label="Cell 6"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="6" aria-label="Cell 7"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="7" aria-label="Cell 8"></div>
            <div class="cell" role="gridcell" tabindex="0" data-i="8" aria-label="Cell 9"></div>
        </div>

        <div class="footer">
            <div class="pill" id="mode">Mode: Human vs Human</div>
            <div class="pill" id="result">Result: —</div>
        </div>
    </div>

    <script>
        (() => {
            const statusEl = document.getElementById('status');
            const resultEl = document.getElementById('result');
            const modeEl = document.getElementById('mode');
            const boardEl = document.getElementById('board');
            const cells = Array.from(document.querySelectorAll('.cell'));
            const vsAIEl = document.getElementById('vsAI');
            const restartEl = document.getElementById('restart');

            const LINES = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8],
                [0, 3, 6], [1, 4, 7], [2, 5, 8],
                [0, 4, 8], [2, 4, 6],
            ];

            let board, current, active;

            function reset() {
                board = Array(9).fill(null);
                current = 'X';
                active = true;
                cells.forEach(c => {
                    c.textContent = '';
                    c.classList.remove('x', 'o', 'win', 'disabled');
                    c.setAttribute('aria-disabled', 'false');
                });
                resultEl.textContent = 'Result: —';
                updateModeLabel();
                updateStatus();
            }

            function updateModeLabel() {
                modeEl.textContent = `Mode: ${vsAIEl.checked ? 'Human vs AI' : 'Human vs Human'}`;
            }

            function updateStatus(extra = '') {
                if (!active) return;
                const aiNote = vsAIEl.checked && current === 'O' ? ' (AI thinking…)' : '';
                statusEl.innerHTML = `Turn: <b>${current}</b>${aiNote}${extra ? ` — ${extra}` : ''}`;
            }

            function disableBoard() {
                cells.forEach(c => {
                    c.classList.add('disabled');
                    c.setAttribute('aria-disabled', 'true');
                });
            }

            function winnerInfo(b) {
                for (const line of LINES) {
                    const [a, c, d] = line;
                    if (b[a] && b[a] === b[c] && b[a] === b[d]) {
                        return { winner: b[a], line };
                    }
                }
                return { winner: null, line: null };
            }

            function isDraw(b) {
                return b.every(v => v !== null) && !winnerInfo(b).winner;
            }

            function renderCell(i) {
                const v = board[i];
                const el = cells[i];
                el.textContent = v ? v : '';
                el.classList.toggle('x', v === 'X');
                el.classList.toggle('o', v === 'O');
            }

            function endGame(message, winLine = null) {
                active = false;
                disableBoard();
                if (winLine) {
                    winLine.forEach(i => cells[i].classList.add('win'));
                }
                statusEl.innerHTML = message;
                resultEl.textContent = `Result: ${message.replace(/<[^>]*>/g, '')}`;
            }

            function place(i, who) {
                if (!active) return false;
                if (board[i] !== null) return false;
                board[i] = who;
                renderCell(i);

                const { winner, line } = winnerInfo(board);
                if (winner) {
                    endGame(`Winner: <b>${winner}</b>`, line);
                    return true;
                }
                if (isDraw(board)) {
                    endGame(`It's a <b>draw</b>.`);
                    return true;
                }
                return true;
            }

            // Unbeatable minimax AI (AI is 'O', human is 'X')
            function minimax(b, player, depth) {
                const { winner } = winnerInfo(b);
                if (winner === 'O') return { score: 10 - depth };
                if (winner === 'X') return { score: depth - 10 };
                if (b.every(v => v !== null)) return { score: 0 };

                const moves = [];
                for (let i = 0; i < 9; i++) {
                    if (b[i] !== null) continue;
                    b[i] = player;
                    const next = minimax(b, player === 'O' ? 'X' : 'O', depth + 1);
                    moves.push({ i, score: next.score });
                    b[i] = null;
                }

                if (player === 'O') {
                    // maximize
                    let best = moves[0];
                    for (const m of moves) if (m.score > best.score) best = m;
                    return best;
                } else {
                    // minimize
                    let best = moves[0];
                    for (const m of moves) if (m.score < best.score) best = m;
                    return best;
                }
            }

            function aiMove() {
                if (!active) return;
                if (!vsAIEl.checked) return;
                if (current !== 'O') return;

                updateStatus();
                // small delay to feel natural
                setTimeout(() => {
                    if (!active) return;
                    const best = minimax(board.slice(), 'O', 0);
                    if (best && best.i != null) {
                        place(best.i, 'O');
                        if (active) {
                            current = 'X';
                            updateStatus();
                        }
                    }
                }, 180);
            }

            function handleTurn(i) {
                if (!active) return;

                // If vs AI and it's AI's turn, ignore user input.
                if (vsAIEl.checked && current === 'O') return;

                const ok = place(i, current);
                if (!ok) return;

                if (!active) return;

                current = (current === 'X') ? 'O' : 'X';
                updateStatus();

                if (vsAIEl.checked) aiMove();
            }

            function onCellActivate(e) {
                const el = e.target.closest('.cell');
                if (!el) return;
                const i = Number(el.dataset.i);
                if (Number.isNaN(i)) return;
                handleTurn(i);
            }

            // Click support
            boardEl.addEventListener('click', onCellActivate);

            // Keyboard support (Enter/Space)
            boardEl.addEventListener('keydown', (e) => {
                if (e.key !== 'Enter' && e.key !== ' ') return;
                const el = e.target.closest('.cell');
                if (!el) return;
                e.preventDefault();
                const i = Number(el.dataset.i);
                handleTurn(i);
            });

            vsAIEl.addEventListener('change', () => {
                updateModeLabel();
                // If user toggles AI on mid-game and it's O's turn, let AI play.
                if (active && vsAIEl.checked && current === 'O') aiMove();
                updateStatus();
            });

            restartEl.addEventListener('click', reset);

            reset();
        })();
    </script>
</body>

</html>